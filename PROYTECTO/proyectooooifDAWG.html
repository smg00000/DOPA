<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Inglés Técnico — Sistemas Microinformáticos y Redes</title>
<meta name="description" content="Página interactiva para aprender vocabulario técnico en inglés sobre hardware, sistemas operativos, redes y seguridad." />
<style>
:root {
  --bg: #f7f8fb;
  --card: #ffffff;
  --accent: #1366d6;
  --muted: #6b7280;
  --glass: rgba(255,255,255,0.6);
  --border: rgba(0,0,0,0.06);
  --shadow: 0 4px 12px rgba(15,23,42,0.08);
  --transition: all 0.3s ease;
  --pattern: url("image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%231366d6' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}

body {
  background-image: var(--pattern), linear-gradient(180deg, var(--bg), #ffffff 60%);
}

[data-theme="dark"] {
  --bg: #0b1220;
  --card: #0f1724;
  --accent: #3b82f6;
  --muted: #cbd5e1;
  --glass: rgba(255,255,255,0.03);
  --border: rgba(255,255,255,0.08);
  --shadow: 0 4px 12px rgba(0,0,0,0.2);
  background-image: none;
}

* { box-sizing: border-box; }
body {
  font-family: 'Segoe UI', Inter, system-ui, -apple-system, sans-serif;
  margin: 0;
  color: var(--muted);
  min-height: 100vh;
  line-height: 1.6;
}

[data-theme="dark"] * {
  color: var(--muted) !important;
}

header {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px 20px;
  background: var(--card);
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow);
  position: sticky;
  top: 0;
  z-index: 100;
}

header h1 {
  margin: 0;
  font-size: 28px;
  font-weight: 700;
  background: linear-gradient(90deg, #1366d6, #8b5cf6);
  background-size: 200% 200%;
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  animation: gradientShift 4s ease-in-out infinite alternate;
  display: flex;
  align-items: center;
  gap: 12px;
  text-align: center;
  justify-content: center;
}

@keyframes gradientShift {
  0% {
    background-position: 0% 50%;
  }
  100% {
    background-position: 100% 50%;
  }
}

header h1 svg {
  width: 24px;
  height: 24px;
  fill: currentColor;
}

.controls {
  position: absolute;
  right: 20px;
  display: flex;
  gap: 10px;
  align-items: center;
  min-width: fit-content;
}

.btn {
  background: transparent;
  border: 1px solid var(--border);
  padding: 6px 10px;
  border-radius: 8px;
  cursor: pointer;
  color: var(--muted);
  font-size: 13px;
  transition: var(--transition);
}

.btn:hover {
  background: var(--glass);
}

main {
  padding: 16px;
  max-width: 1200px;
  margin: 0 auto 24px;
  display: grid;
  grid-template-columns: 1fr 320px;
  gap: 20px;
}

.card {
  background: var(--card);
  padding: 18px;
  border-radius: 16px;
  box-shadow: var(--shadow);
  position: relative;
}

aside .card::before {
  content: "";
  position: absolute;
  top: 12px;
  right: 12px;
  width: 40px;
  height: 40px;
  opacity: 0.1;
  background-image: url("image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%231366d6'%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3Cpath d='M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z'/%3E%3C/svg%3E");
  background-size: contain;
  pointer-events: none;
}

[data-theme="dark"] aside .card::before {
  opacity: 0.08;
  background-image: url("image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233b82f6'%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3Cpath d='M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z'/%3E%3C/svg%3E");
}

nav ul {
  display: flex;
  gap: 12px;
  list-style: none;
  padding: 0;
  margin: 24px auto 20px;
  justify-content: center;
  flex-wrap: wrap;
}

nav button {
  background: var(--card);
  border: 2px solid var(--border);
  color: var(--muted);
  cursor: pointer;
  padding: 16px 24px;
  border-radius: 14px;
  font-weight: 600;
  font-size: 18px;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 10px;
  min-width: 160px;
  justify-content: center;
  height: auto;
}

nav button svg {
  width: 22px;
  height: 22px;
  fill: var(--muted);
}

nav button:hover svg,
nav button.active svg {
  fill: var(--accent);
}

nav button:hover, nav button.active {
  background: var(--glass);
  color: var(--accent);
  border-color: var(--accent);
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(19, 102, 214, 0.25);
}

.lesson-card {
  background: var(--card);
  border-radius: 14px;
  box-shadow: var(--shadow);
  margin-bottom: 20px;
  overflow: hidden;
  transition: var(--transition);
  cursor: pointer;
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 18px;
  min-height: 80px;
}

.lesson-icon {
  flex-shrink: 0;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 12px;
  background: var(--glass);
  color: var(--accent);
}

.lesson-icon svg {
  width: 24px;
  height: 24px;
  fill: currentColor;
}

.lesson-content-wrapper {
  flex: 1;
}

.lesson-header {
  font-weight: 600;
  color: var(--accent);
  margin: 0;
  font-size: 18px;
}

.progress {
  height: 6px;
  background: var(--border);
  border-radius: 3px;
  overflow: hidden;
  margin-top: 4px;
}

.progress > i {
  display: block;
  height: 100%;
  background: linear-gradient(90deg, var(--accent), #60a5fa);
  width: 0%;
  transition: width 0.4s ease;
}

.flashcards-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 14px;
  margin-bottom: 16px;
}

.flashcard-container {
  height: 140px;
  perspective: 1000px;
  cursor: pointer;
}

.flashcard-inner {
  position: relative;
  width: 100%;
  height: 100%;
  text-align: center;
  transition: transform 0.6s;
  transform-style: preserve-3d;
}

.flashcard-container.flipped .flashcard-inner {
  transform: rotateY(180deg);
}

.flashcard-face {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10px;
  border-radius: 12px;
  font-weight: 600;
  font-size: 14px;
  overflow: hidden;
}

.flashcard-front {
  background: linear-gradient(135deg, #e0f2fe, #dbeafe);
  color: var(--accent);
  border: 1px solid var(--border);
}

.flashcard-back {
  background: linear-gradient(135deg, #f0fdf4, #dcfce7);
  color: #065f46;
  transform: rotateY(180deg);
  border: 1px solid #10b981;
}

[data-theme="dark"] .flashcard-front {
  background: linear-gradient(135deg, #0c4a6e, #1e3a8a);
  color: #93c5fd;
}

[data-theme="dark"] .flashcard-back {
  background: linear-gradient(135deg, #064e3b, #166534);
  color: #bbf7d0;
}

.flashcard-controls {
  display: flex;
  gap: 8px;
  justify-content: center;
  flex-wrap: wrap;
}

.choices button {
  display: block;
  width: 100%;
  text-align: left;
  margin: 6px 0;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: var(--glass);
  cursor: pointer;
  transition: var(--transition);
  font-weight: 500;
}

.choices button:hover:not(:disabled) {
  background: rgba(19, 102, 214, 0.1);
}

.choices button.correct {
  background: #d1fae5 !important;
  color: #065f46;
  border-color: #10b981;
}

.choices button.incorrect {
  background: #fee2e2 !important;
  color: #991b1b;
  border-color: #ef4444;
}

footer {
  max-width: 1200px;
  margin: 0 auto 20px;
  padding: 0 16px;
  color: var(--muted);
  font-size: 12px;
  text-align: center;
}

input, select, button {
  font-family: inherit;
}

#translateOutput {
  min-height: 24px;
  transition: color 0.2s;
}

@media (max-width: 900px) {
  main {
    grid-template-columns: 1fr;
    padding: 12px;
  }
  aside {
    order: -1;
  }
  .flashcards-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  .lesson-card {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
  }
  header h1 {
    font-size: 22px;
  }
  nav ul {
    gap: 10px;
    margin: 20px auto 18px;
  }
  nav button {
    padding: 14px 20px;
    font-size: 16px;
    min-width: 140px;
  }
  .controls {
    position: static;
    margin-top: 12px;
    justify-content: center;
  }
}
</style>
</head>
<body>
<header>
  <h1>
    <svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg>
    Inglés Técnico — SMR
  </h1>
  <div class="controls">
    <label for="speechRate" style="font-size:13px">Vel:</label>
    <input id="speechRate" type="range" min="0.6" max="1.6" step="0.1" value="1" style="width:80px" />
    <button id="themeBtn" class="btn">Tema</button>
    <button id="resetBtn" class="btn">Reset</button>
  </div>
</header>

<main>
  <section class="card" id="mainArea">
    <div id="content"></div>
  </section>

  <aside class="card">
    <h3 style="color:var(--accent); margin-top:0; font-size:16px">Vocabulario técnico</h3>
    <div id="vocabList" style="max-height:180px; overflow-y:auto; padding-right:4px"></div>
    <hr style="margin:12px 0"/>
    <h4 style="font-size:14px">Traductor Inglés ⇄ Español</h4>
    <select id="langSelect" style="width:100%;margin-bottom:8px;padding:8px;border-radius:8px;border:1px solid var(--border); font-size:13px">
      <option value="en-es">Inglés → Español</option>
      <option value="es-en">Español → Inglés</option>
    </select>
    <input id="translateInput" placeholder="Escribe texto a traducir" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--border); font-size:13px" />
    <button id="translateBtn" class="btn" style="margin-top:6px;width:100%; padding:8px">Traducir</button>
    <div id="translateOutput" style="margin-top:10px;font-weight:600;"></div>
    <hr style="margin:12px 0"/>
    <h4 style="font-size:14px">Pronunciar</h4>
    <input id="sayInput" placeholder="Escribe texto en inglés" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--border); font-size:13px" />
    <div style="display:flex;gap:6px;margin-top:8px">
      <button id="sayBtn" class="btn" style="flex:1; padding:8px">▶ Escuchar</button>
      <button id="addVocabBtn" class="btn" style="flex:1; padding:8px">+ Vocab</button>
    </div>
  </aside>
</main>

<footer>
  <p>© 2025 Inglés Técnico — SMR | Herramienta educativa interactiva</p>
</footer>

<script>
const lessons = [
  { 
    id:1, 
    title:'Hardware básico', 
    icon: `<svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M18 2h-2v2h-2V2h-2v2H8V2H6v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-2V2zm-2 12H8v-2h8v2zm4-4H4V6h16v4z"/></svg>`,
    text:`Motherboard = Placa base
CPU = Procesador
RAM = Memoria RAM
Power supply = Fuente de alimentación
Storage drive = Unidad de almacenamiento
Network card = Tarjeta de red
Graphics card = Tarjeta gráfica
Cooling fan = Ventilador de refrigeración
Peripheral = Periférico
Monitor = Pantalla`,
    vocab:['motherboard','cpu','ram','power supply','storage drive','network card','graphics card','cooling fan','peripheral','monitor']
  },
  { 
    id:2, 
    title:'Sistemas operativos', 
    icon: `<svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>`,
    text:`Operating System = Sistema operativo
File system = Sistema de archivos
User account = Cuenta de usuario
Driver = Controlador
Update = Actualización
Command line = Línea de comandos
Kernel = Núcleo
Process = Proceso
Task manager = Administrador de tareas
Registry = Registro del sistema`,
    vocab:['operating system','file system','user account','driver','update','command line','kernel','process','task manager','registry']
  },
  { 
    id:3, 
    title:'Redes y protocolos', 
    icon: `<svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>`,
    text:`Network = Red
IP Address = Dirección IP
Router = Enrutador
Switch = Conmutador
Firewall = Cortafuegos
DNS (Domain Name System) = Sistema de nombres de dominio
Gateway = Puerta de enlace
Subnet mask = Máscara de subred
Bandwidth = Ancho de banda
Packet loss = Pérdida de paquetes
Wireless = Inalámbrico
Ethernet cable = Cable Ethernet`,
    vocab:['network','ip address','router','switch','firewall','dns','gateway','subnet mask','bandwidth','packet loss','wireless','ethernet cable']
  },
  { 
    id:4, 
    title:'Seguridad informática', 
    icon: `<svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm-1-9V6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9z"/></svg>`,
    text:`Encryption = Cifrado
Authentication = Autenticación
Antivirus = Antivirus
Malware = Software malicioso
Backup = Copia de seguridad
Phishing = Suplantación de identidad
Firewall rules = Reglas del cortafuegos
Data breach = Fuga de datos
Cyberattack = Ciberataque
VPN (Virtual Private Network) = Red privada virtual`,
    vocab:['encryption','authentication','antivirus','malware','backup','phishing','firewall rules','data breach','cyberattack','vpn']
  }
];

const state = {
  currentLessonId: null,
  vocab: JSON.parse(localStorage.getItem('vocab') || '[]'),
  score: JSON.parse(localStorage.getItem('score') || '{}')
};

const content = document.getElementById('content');
const vocabList = document.getElementById('vocabList');

const translations = {
  motherboard:'Placa base',
  cpu:'Procesador',
  ram:'Memoria RAM',
  'power supply':'Fuente de alimentación',
  'storage drive':'Unidad de almacenamiento',
  'network card':'Tarjeta de red',
  'graphics card':'Tarjeta gráfica',
  'cooling fan':'Ventilador de refrigeración',
  peripheral:'Periférico',
  monitor:'Pantalla',
  'operating system':'Sistema operativo',
  'file system':'Sistema de archivos',
  'user account':'Cuenta de usuario',
  driver:'Controlador',
  update:'Actualización',
  'command line':'Línea de comandos',
  kernel:'Núcleo',
  process:'Proceso',
  'task manager':'Administrador de tareas',
  registry:'Registro del sistema',
  network:'Red',
  'ip address':'Dirección IP',
  router:'Enrutador',
  switch:'Conmutador',
  firewall:'Cortafuegos',
  dns:'Sistema de nombres de dominio',
  gateway:'Puerta de enlace',
  'subnet mask':'Máscara de subred',
  bandwidth:'Ancho de banda',
  'packet loss':'Pérdida de paquetes',
  wireless:'Inalámbrico',
  'ethernet cable':'Cable Ethernet',
  encryption:'Cifrado',
  authentication:'Autenticación',
  antivirus:'Antivirus',
  malware:'Software malicioso',
  backup:'Copia de seguridad',
  phishing:'Suplantación de identidad',
  'firewall rules':'Reglas del cortafuegos',
  'data breach':'Fuga de datos',
  cyberattack:'Ciberataque',
  vpn:'Red privada virtual'
};

function init(){
  renderVocab();
  document.getElementById('themeBtn').addEventListener('click', toggleTheme);
  document.getElementById('sayBtn').addEventListener('click', ()=>speak(document.getElementById('sayInput').value));
  document.getElementById('addVocabBtn').addEventListener('click', addVocabFromInput);
  document.getElementById('resetBtn').addEventListener('click', resetProgress);
  document.getElementById('translateBtn').addEventListener('click', doTranslate);
  showMainLessons();
}

function showMainLessons() {
  const allTerms = [...new Set(lessons.flatMap(l => l.vocab))];
  const doneCount = allTerms.filter(term => state.score['quiz_' + term]).length;
  const globalPct = Math.round((doneCount / allTerms.length) * 100) || 0;

  content.innerHTML = `
    <h2 style="color:var(--accent); margin:0 0 14px; font-size:18px">Temas Técnicos</h2>
    <div style="font-size:12px;color:var(--muted); margin-bottom:16px;">
      Progreso general <span>${globalPct}%</span>
      <div class="progress"><i style="width:${globalPct}%"></i></div>
    </div>
  `;

  lessons.forEach((lesson) => {
    const lessonEl = document.createElement('div');
    lessonEl.className = 'lesson-card';
    lessonEl.innerHTML = `
      <div class="lesson-icon">${lesson.icon}</div>
      <div class="lesson-content-wrapper">
        <div class="lesson-header">${lesson.title}</div>
      </div>
    `;
    lessonEl.addEventListener('click', () => {
      state.currentLessonId = lesson.id;
      showLessonDetail(lesson.id);
    });
    content.appendChild(lessonEl);
  });
}

function showLessonDetail(lessonId) {
  const lesson = lessons.find(l => l.id === lessonId);
  if (!lesson) return;

  content.innerHTML = `
    <button id="backToMain" class="btn" style="margin-bottom:12px; padding:6px 10px;">
      ← Volver a temas
    </button>
    <h2 style="color:var(--accent); margin:0 0 14px; font-size:18px">${lesson.title}</h2>
    <nav>
      <ul>
        <li><button data-action="lesson" data-lesson="${lessonId}">
          <svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
          Lecciones
        </button></li>
        <li><button data-action="flashcards" data-lesson="${lessonId}">
          <svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.67A2.996 2.996 0 0 0 6 5c0 .35.07.69.18 1H4c-1.11 0-2 .89-2 2v10c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5.5 3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5.67-1.5 1.5-1.5zM9 16H7v-2h2v2zm0-4H7v-2h2v2zm0-4H7V6h2v2zm8 8h-2v-2h2v2zm0-4h-2v-2h2v2z"/></svg>
          Flashcards
        </button></li>
        <li><button data-action="quiz" data-lesson="${lessonId}">
          <svg viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
          Quiz
        </button></li>
      </ul>
      <div id="lessonProgress" style="display:none; font-size:12px;color:var(--muted); margin-top:8px;">
        Progreso <span id="lessonScoreLabel">0%</span>
        <div class="progress"><i style="width:0%"></i></div>
      </div>
    </nav>
    <div id="lessonContent" style="min-height:100px;"></div>
  `;

  document.getElementById('backToMain').onclick = () => {
    state.currentLessonId = null;
    showMainLessons();
  };

  const lessonContent = document.getElementById('lessonContent');
  // No mostramos nada por defecto

  document.querySelectorAll('#content nav button').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('#content nav button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const action = btn.dataset.action;
      const progressEl = document.getElementById('lessonProgress');
      if (action === 'lesson') {
        showLessonText(lesson, lessonContent);
        progressEl.style.display = 'none';
      } else if (action === 'flashcards') {
        showLessonFlashcards(lesson, lessonContent);
        progressEl.style.display = 'none';
      } else if (action === 'quiz') {
        // Mostrar progreso solo en Quiz
        const done = lesson.vocab.filter(term => state.score['quiz_' + term]).length;
        const pct = Math.round((done / lesson.vocab.length) * 100) || 0;
        document.getElementById('lessonScoreLabel').textContent = pct + '%';
        document.querySelector('#lessonProgress .progress > i').style.width = pct + '%';
        progressEl.style.display = 'block';
        showLessonQuiz(lesson, lessonContent);
      }
    });
  });
}

function showLessonText(lesson, container) {
  const lines = lesson.text.split('\n').filter(line => line.trim());
  let html = '<div style="display:grid;gap:8px;">';
  lines.forEach(line => {
    const parts = line.split(' = ');
    if (parts.length === 2) {
      const en = parts[0].trim();
      const es = parts[1].trim();
      html += `
        <div style="
          display: flex;
          align-items: center;
          gap: 8px;
          padding: 6px 10px;
          background: var(--glass);
          border-radius: 8px;
          border: 1px solid var(--border);
          font-size: 14px;
        ">
          <span style="color: var(--accent); font-weight: 600;">${en}</span>
          <span style="color: var(--muted);">=</span>
          <span style="color: var(--muted);">${es}</span>
        </div>
      `;
    }
  });
  html += '</div>';
  container.innerHTML = html;
}

function showLessonFlashcards(lesson, container) {
  const words = lesson.vocab;
  if (words.length === 0) {
    container.innerHTML = `<p style="color:var(--muted)">No hay vocabulario en esta lección.</p>`;
    return;
  }

  container.innerHTML = `
    <div class="flashcards-grid" id="lessonFlashcardsGrid"></div>
    <div class="flashcard-controls">
      <button id="shuffleLessonBtn" class="btn">Mezclar</button>
    </div>
  `;

  const grid = document.getElementById('lessonFlashcardsGrid');
  let currentWords = [...words];

  function renderCards() {
    grid.innerHTML = '';
    currentWords.forEach(word => {
      const containerCard = document.createElement('div');
      containerCard.className = 'flashcard-container';
      containerCard.innerHTML = `
        <div class="flashcard-inner">
          <div class="flashcard-face flashcard-front">${word}</div>
          <div class="flashcard-face flashcard-back">${translations[word] || '(traducción)'}</div>
        </div>
      `;
      containerCard.addEventListener('click', () => containerCard.classList.toggle('flipped'));
      containerCard.addEventListener('dblclick', () => speak(word));
      grid.appendChild(containerCard);
    });
  }

  renderCards();

  document.getElementById('shuffleLessonBtn').onclick = () => {
    for (let i = currentWords.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [currentWords[i], currentWords[j]] = [currentWords[j], currentWords[i]];
    }
    renderCards();
  };
}

function showLessonQuiz(lesson, container) {
  const words = lesson.vocab;
  if (words.length === 0) {
    container.innerHTML = `<p>No hay términos para el quiz en esta lección.</p>`;
    return;
  }

  const w = words[Math.floor(Math.random() * words.length)];
  const correct = translations[w] || '(traducción)';
  const optsSet = new Set([correct]);
  while (optsSet.size < 4) {
    const other = words[Math.floor(Math.random() * words.length)];
    const t = translations[other] || '(traducción)';
    optsSet.add(t);
  }
  const options = [...optsSet].sort(() => Math.random() - 0.5);

  container.innerHTML = `
    <div class='quiz card' style="padding:16px">
      <div style='font-weight:600;color:var(--accent); margin-bottom:14px'>¿Qué significa: <em>${w}</em>?</div>
      <div class='choices' id='lessonChoices'></div>
      <div style='margin-top:14px'><button id='nextLessonQuestion' class='btn' style="width:100%">Siguiente ➜</button></div>
    </div>
  `;

  const ch = document.getElementById('lessonChoices');
  options.forEach(o => {
    const b = document.createElement('button');
    b.textContent = o;
    b.onclick = () => {
      if (b.disabled) return;
      const ok = (o === correct);
      if (ok) { 
        b.classList.add('correct'); 
        state.score['quiz_' + w] = true; 
        localStorage.setItem('score', JSON.stringify(state.score));
        // Actualizar progreso en la lección (solo si seguimos en Quiz)
        const done = lesson.vocab.filter(term => state.score['quiz_' + term]).length;
        const pct = Math.round((done / lesson.vocab.length) * 100) || 0;
        const label = document.getElementById('lessonScoreLabel');
        const bar = document.querySelector('#lessonProgress .progress > i');
        if (label) label.textContent = pct + '%';
        if (bar) bar.style.width = pct + '%';
      } else { 
        b.classList.add('incorrect'); 
      }
      ch.querySelectorAll('button').forEach(btn => {
        btn.disabled = true;
        if (btn.textContent === correct) btn.classList.add('correct');
      });
    };
    ch.appendChild(b);
  });

  document.getElementById('nextLessonQuestion').onclick = () => showLessonQuiz(lesson, container);
}

async function doTranslate() {
  const dir = document.getElementById('langSelect').value;
  const input = document.getElementById('translateInput').value.trim();
  const output = document.getElementById('translateOutput');
  
  if (!input) {
    output.textContent = 'Escribe algo para traducir.';
    output.style.color = 'var(--muted)';
    return;
  }

  output.textContent = 'Traduciendo...';
  output.style.color = 'var(--muted)';

  try {
    const [sourceLang, targetLang] = dir === 'en-es' ? ['en', 'es'] : ['es', 'en'];
    const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sourceLang}&tl=${targetLang}&dt=t&q=${encodeURIComponent(input)}`;
    
    const response = await fetch(url);
    const data = await response.json();
    
    if (data && data[0] && data[0][0] && data[0][0][0]) {
      const translation = data[0][0][0];
      output.textContent = translation;
      output.style.color = 'var(--accent)';
    } else {
      throw new Error('Respuesta inesperada');
    }
  } catch (error) {
    console.error('Error al traducir:', error);
    output.textContent = '⚠️ No se pudo traducir. ¿Estás conectado a internet?';
    output.style.color = '#ef4444';
  }
}

function speak(t){
  if(!t) return;
  const s = new SpeechSynthesisUtterance(t);
  s.lang = 'en-US';
  s.rate = parseFloat(document.getElementById('speechRate').value) || 1;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(s);
}

function renderVocab(){
  vocabList.innerHTML = '';
  if(state.vocab.length === 0) {
    vocabList.innerHTML = '<p style="color:var(--muted); font-style:italic; font-size:13px;">No hay vocabulario personalizado.</p>';
    return;
  }
  state.vocab.forEach((w,i)=>{
    const d = document.createElement('div');
    d.style.display = 'flex';
    d.style.justifyContent = 'space-between';
    d.style.alignItems = 'center';
    d.style.marginBottom = '6px';
    d.style.fontSize = '13px';
    d.innerHTML = `<div style="flex:1; overflow:hidden; text-overflow:ellipsis;">${w}</div>
                   <div><button class='btn' data-i='${i}' style="padding:3px 6px; font-size:11px;">▶</button>
                   <button class='btn' data-del='${i}' style="padding:3px 6px; font-size:11px;">✖</button></div>`;
    vocabList.appendChild(d);
  });
  vocabList.querySelectorAll('button[data-i]').forEach(b=>{
    b.onclick = e => speak(state.vocab[e.target.dataset.i]);
  });
  vocabList.querySelectorAll('button[data-del]').forEach(b=>{
    b.onclick = e => {
      const i = parseInt(e.target.dataset.del);
      state.vocab.splice(i,1);
      localStorage.setItem('vocab', JSON.stringify(state.vocab));
      renderVocab();
    };
  });
}

function addVocabFromInput(){
  const t = document.getElementById('sayInput').value.trim();
  if(!t) return alert('Escribe algo para añadir.');
  if(!state.vocab.includes(t)) {
    state.vocab.push(t);
    localStorage.setItem('vocab', JSON.stringify(state.vocab));
    renderVocab();
  }
}

function toggleTheme(){
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  document.documentElement.setAttribute('data-theme', isDark ? '' : 'dark');
}

function resetProgress(){
  if(confirm('¿Borrar vocabulario y progreso?')){
    localStorage.clear();
    state.vocab = [];
    state.score = {};
    renderVocab();
    showMainLessons();
  }
}

init();
</script>
</body>
</html>